<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="700"
        x:Class="TranslationToolUI.Views.AiConfigView"
        Title="AI 服务配置"
        Width="600" Height="700"
        WindowStartupLocation="CenterOwner">

    <Grid RowDefinitions="Auto,*,Auto" Margin="20">
        <TextBlock Grid.Row="0" Text="AI 洞察服务配置" FontSize="18"
                   FontWeight="Bold" Margin="0,0,0,20"/>

        <ScrollViewer Grid.Row="1">
            <StackPanel Spacing="12">
                <StackPanel Spacing="5">
                    <TextBlock Text="服务类型"/>
                    <ComboBox x:Name="ProviderTypeComboBox" MinWidth="280">
                        <ComboBoxItem Content="OpenAI 兼容 (OpenAI / DeepSeek / Ollama 等)"/>
                        <ComboBoxItem Content="Azure OpenAI"/>
                    </ComboBox>
                </StackPanel>

                <StackPanel Spacing="5">
                    <TextBlock Text="API 端点"/>
                    <TextBox x:Name="ApiEndpointTextBox"
                             Watermark="例如: https://api.openai.com"/>
                    <TextBlock FontSize="10" Foreground="Gray"
                               Text="无需包含 /v1/chat/completions 路径"/>
                </StackPanel>

                <StackPanel Spacing="5">
                    <TextBlock Text="API 密钥"/>
                    <TextBox x:Name="ApiKeyTextBox"
                             Watermark="sk-..."
                             PasswordChar="*"
                             RevealPassword="{Binding IsChecked, ElementName=ShowApiKeyCheckBox}"/>
                    <CheckBox x:Name="ShowApiKeyCheckBox" Content="显示密钥"
                              FontSize="10" Margin="0,2,0,0"/>
                </StackPanel>

                <StackPanel x:Name="ModelNamePanel" Spacing="8">
                    <TextBlock Text="模型名称 (OpenAI 兼容)"/>
                    <StackPanel Spacing="4">
                        <TextBlock Text="快速应答模型 (默认)" FontSize="11" Foreground="Gray"/>
                        <TextBox x:Name="QuickModelNameTextBox"
                                 Watermark="例如: gpt-5.2-chat"/>
                    </StackPanel>
                    <StackPanel Spacing="4">
                        <TextBlock Text="总结模型" FontSize="11" Foreground="Gray"/>
                        <TextBox x:Name="SummaryModelNameTextBox"
                                 Watermark="例如: gpt-5.2"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel x:Name="AzureFieldsPanel" Spacing="10" IsVisible="False">
                    <StackPanel Spacing="5">
                        <TextBlock Text="快速应答部署名称 (默认)"/>
                        <TextBox x:Name="QuickDeploymentNameTextBox"
                                 Watermark="Azure OpenAI 快速应答部署名"/>
                    </StackPanel>
                    <StackPanel Spacing="5">
                        <TextBlock Text="总结部署名称"/>
                        <TextBox x:Name="SummaryDeploymentNameTextBox"
                                 Watermark="Azure OpenAI 总结部署名"/>
                    </StackPanel>
                    <StackPanel Spacing="5">
                        <TextBlock Text="API 版本"/>
                        <TextBox x:Name="ApiVersionTextBox"
                                 Watermark="例如: 2024-02-01"
                                 Text="2024-02-01"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Spacing="5">
                    <CheckBox x:Name="SummaryReasoningCheckBox"
                              Content="总结模型开启思考"
                              FontSize="11"/>
                    <TextBlock FontSize="10" Foreground="Gray"
                               Text="仅在支持思考/推理的模型上开启"/>
                </StackPanel>

                <TextBlock x:Name="StatusTextBlock" FontSize="11" Foreground="Gray"
                           TextWrapping="Wrap" Margin="0,4,0,0"/>

                <!-- 预设按钮配置 -->
                <Border BorderBrush="#FFE2E8F0" BorderThickness="0,1,0,0" Padding="0,12,0,0" Margin="0,8,0,0">
                    <StackPanel Spacing="8">
                        <TextBlock Text="洞察预设按钮配置" FontSize="14" FontWeight="SemiBold"/>
                        <TextBlock Text="自定义按钮的名称和对应的提示词" FontSize="11" Foreground="Gray"/>
                        <ItemsControl x:Name="PresetButtonsItemsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="Auto,120,Auto,*,Auto" Margin="0,4">
                                        <TextBlock Grid.Column="0" Text="名称:" FontSize="11"
                                                   VerticalAlignment="Center" Margin="0,0,6,0"/>
                                        <TextBox Grid.Column="1" Text="{Binding Name, Mode=TwoWay}"
                                                 Padding="4,3" VerticalAlignment="Center"/>
                                        <TextBlock Grid.Column="2" Text="提示词:" FontSize="11"
                                                   VerticalAlignment="Center" Margin="10,0,6,0"/>
                                        <TextBox Grid.Column="3" Text="{Binding Prompt, Mode=TwoWay}"
                                                 Padding="4,3" VerticalAlignment="Center"/>
                                        <Button Grid.Column="4" Content="删除" Margin="6,0,0,0" Padding="6,2"
                                                FontSize="11" Click="RemovePresetButton_Click"
                                                Tag="{Binding}"/>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <Button x:Name="AddPresetButton" Content="+ 添加按钮" Padding="8,4"
                                FontSize="11" HorizontalAlignment="Left"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.Row="2" Orientation="Horizontal"
                    HorizontalAlignment="Right" Spacing="10" Margin="0,20,0,0">
            <Button x:Name="TestButton" Content="测试连接" Width="100"/>
            <Button x:Name="SaveButton" Content="保存" Width="80"/>
            <Button x:Name="CancelButton" Content="取消" Width="80"/>
        </StackPanel>
    </Grid>
</Window>
