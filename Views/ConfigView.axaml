<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:models="using:TrueFluentPro.Models"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="500"
        x:Class="TrueFluentPro.Views.ConfigView"
        Title="Azure 订阅管理"
        Width="600" Height="500"
        WindowStartupLocation="CenterOwner">
    
    <Grid RowDefinitions="Auto,*,Auto" Margin="20">
        <TextBlock Grid.Row="0" Text="Azure 语音服务订阅管理" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>
        
        <ScrollViewer Grid.Row="1">
            <Grid ColumnDefinitions="*,Auto">
                <!-- 左侧订阅列表 -->
                <Border Grid.Column="0" BorderBrush="Gray" BorderThickness="1" Margin="0,0,10,0">
                    <Grid RowDefinitions="Auto,*">
                        <TextBlock Grid.Row="0" Text="订阅列表" FontWeight="Bold" Margin="10,10,10,5"/>                        <ListBox Grid.Row="1" x:Name="SubscriptionListBox" Margin="10" 
                                 SelectionMode="Single">                            <ListBox.ItemTemplate>
                                <DataTemplate DataType="models:AzureSubscription">
                                    <StackPanel Orientation="Vertical" Margin="5">
                                        <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding ServiceRegion}" FontSize="12" Foreground="Gray"/>
                                        <TextBlock Text="密钥: **********************" FontSize="10" Foreground="DarkGray"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>
                
                <!-- 右侧编辑区域 -->
                <StackPanel Grid.Column="1" Spacing="10" MinWidth="250">
                    <TextBlock Text="订阅配置" FontWeight="Bold"/>
                    
                    <StackPanel Spacing="5">
                        <TextBlock Text="订阅名称"/>
                        <TextBox x:Name="SubscriptionNameTextBox" Watermark="例如：生产环境、测试环境"/>
                    </StackPanel>
                      <StackPanel Spacing="5">
                        <TextBlock Text="订阅密钥"/>
                        <TextBox x:Name="SubscriptionKeyTextBox" 
                                 Watermark="输入 Azure 语音服务订阅密钥"
                                 MaxWidth="280" 
                                 Width="280"
                                 PasswordChar="*"
                                 RevealPassword="{Binding IsChecked, ElementName=ShowPasswordCheckBox}"/>
                        <CheckBox x:Name="ShowPasswordCheckBox" Content="显示密钥" FontSize="10" Margin="0,2,0,0"/>
                    </StackPanel>
                      <StackPanel Spacing="5">
                        <TextBlock Text="服务区域"/>
                        <ComboBox x:Name="RegionComboBox">
                            <ComboBoxItem Tag="southeastasia" Content="东南亚（新加坡）"/>
                            <ComboBoxItem Tag="eastasia" Content="东亚（香港）"/>
                            <ComboBoxItem Tag="eastus" Content="美国东部"/>
                            <ComboBoxItem Tag="westus" Content="美国西部"/>
                            <ComboBoxItem Tag="westeurope" Content="西欧"/>
                            <ComboBoxItem Tag="northeurope" Content="北欧"/>
                            <ComboBoxItem Tag="japaneast" Content="日本东部"/>
                            <ComboBoxItem Tag="koreacentral" Content="韩国中部"/>
                        </ComboBox>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" Spacing="5" Margin="0,20,0,0">
                        <Button x:Name="AddButton" Content="添加" Width="60"/>
                        <Button x:Name="UpdateButton" Content="更新" Width="60"/>
                        <Button x:Name="DeleteButton" Content="删除" Width="60"/>
                        <Button x:Name="TestButton" Content="测试" Width="60"/>
                    </StackPanel>
                    
                    <Separator Margin="0,20,0,10"/>
                    
                    <!-- 其他设置 -->
                    <TextBlock Text="其他设置" FontWeight="Bold"/>
                    
                    <CheckBox x:Name="FilterModalParticlesCheckBox" Content="过滤语气助词" IsChecked="True"/>
                    
                    <StackPanel Spacing="5">
                        <TextBlock Text="最大历史记录数量"/>
                        <NumericUpDown x:Name="MaxHistoryItemsNumeric" Value="15" Minimum="5" Maximum="100" Width="120" FormatString="F0"/>
                    </StackPanel>
                    
                    <StackPanel Spacing="5">
                        <TextBlock Text="实时字幕最大长度"/>
                        <NumericUpDown x:Name="RealtimeMaxLengthNumeric" Value="150" Minimum="50" Maximum="500" Width="120" FormatString="F0"/>
                    </StackPanel>

                    <Separator Margin="0,10,0,10"/>

                    <TextBlock Text="静音超时" FontWeight="Bold"/>

                    <CheckBox x:Name="EnableAutoTimeoutCheckBox" Content="启用静音超时" IsChecked="True"/>

                    <StackPanel Spacing="5">
                        <TextBlock Text="初始静音超时 (秒)"/>
                        <NumericUpDown x:Name="InitialSilenceTimeoutSecondsNumeric" Value="25" Minimum="1" Maximum="300" Width="120" FormatString="F0"/>
                        <TextBlock FontSize="10" Foreground="Gray" Text="未检测到语音的等待时间" TextWrapping="Wrap"/>
                    </StackPanel>

                    <StackPanel Spacing="5">
                        <TextBlock Text="断句静音超时 (秒)"/>
                        <NumericUpDown x:Name="EndSilenceTimeoutSecondsNumeric" Value="1" Minimum="1" Maximum="30" Width="120" FormatString="F0"/>
                        <TextBlock FontSize="10" Foreground="Gray" Text="识别到语音后，判定一句结束的等待时间" TextWrapping="Wrap"/>
                    </StackPanel>

                    <Separator Margin="0,10,0,10"/>

                    <TextBlock Text="无回显重连" FontWeight="Bold"/>

                    <CheckBox x:Name="EnableNoResponseRestartCheckBox" Content="有音频输入但无回显时自动重连" IsChecked="False"/>

                    <StackPanel Spacing="5">
                        <TextBlock Text="无回显阈值 (秒)"/>
                        <NumericUpDown x:Name="NoResponseRestartSecondsNumeric" Value="3" Minimum="1" Maximum="30" Width="120" FormatString="F0"/>
                        <TextBlock FontSize="10" Foreground="Gray" Text="连续 N 秒无中间/最终结果且检测到音频活动时触发" TextWrapping="Wrap"/>
                    </StackPanel>

                    <StackPanel Spacing="5">
                        <TextBlock Text="音频活动阈值"/>
                        <NumericUpDown x:Name="AudioActivityThresholdNumeric" Value="600" Minimum="50" Maximum="8000" Width="120" FormatString="F0"/>
                        <TextBlock FontSize="10" Foreground="Gray" Text="PCM 16-bit 幅度阈值；越大越不敏感" TextWrapping="Wrap"/>
                    </StackPanel>

                    <StackPanel Spacing="5">
                        <TextBlock Text="电平显示放大倍数"/>
                        <NumericUpDown x:Name="AudioLevelGainNumeric" Value="2" Minimum="0.5" Maximum="10" Width="120" FormatString="F1"/>
                        <TextBlock FontSize="10" Foreground="Gray" Text="仅影响电平显示，不影响识别" TextWrapping="Wrap"/>
                    </StackPanel>

                    <StackPanel Spacing="5">
                        <TextBlock Text="自动增益预设"/>
                        <ComboBox x:Name="AutoGainPresetComboBox" MinWidth="140">
                            <ComboBoxItem Content="关闭"/>
                            <ComboBoxItem Content="低"/>
                            <ComboBoxItem Content="中"/>
                            <ComboBoxItem Content="高"/>
                        </ComboBox>
                        <TextBlock FontSize="10" Foreground="Gray"
                                   Text="自动提升识别与录音音量，不影响听感" TextWrapping="Wrap"/>
                    </StackPanel>

                    <CheckBox x:Name="ShowReconnectMarkerCheckBox" Content="在字幕中显示 *触发重连* 提示" IsChecked="True"/>

                    <Separator Margin="0,10,0,10"/>

                    <StackPanel Spacing="5">
                        <TextBlock Text="Chunk 时长 (ms)"/>
                        <NumericUpDown x:Name="ChunkDurationMsNumeric" Value="200" Minimum="20" Maximum="2000" Width="120" FormatString="F0"/>
                        <TextBlock FontSize="10" Foreground="Gray" Text="默认 200ms；可改为 500ms（延迟更高）" TextWrapping="Wrap"/>
                    </StackPanel>

                    <StackPanel Spacing="8">
                        <CheckBox x:Name="EnableRecordingCheckBox" Content="边翻译边录音（直接输出 MP3）" IsChecked="True"/>

                        <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                            <TextBlock Text="MP3 码率 (kbps)" VerticalAlignment="Center"/>
                            <NumericUpDown x:Name="RecordingMp3BitrateNumeric" Value="256" Minimum="32" Maximum="320" Width="120" FormatString="F0"/>
                        </StackPanel>
                    </StackPanel>

                    <Separator Margin="0,10,0,10"/>

                    <TextBlock Text="字幕输出" FontWeight="Bold"/>

                    <StackPanel Spacing="6">
                        <CheckBox x:Name="ExportSrtCheckBox" Content="生成 SRT 字幕" IsChecked="False"/>
                        <CheckBox x:Name="ExportVttCheckBox" Content="生成 VTT 字幕" IsChecked="False"/>
                        <TextBlock FontSize="10" Foreground="Gray" Text="字幕与录音同目录保存，可同时勾选" TextWrapping="Wrap"/>
                    </StackPanel>
                    
                    <StackPanel Spacing="5">
                        <TextBlock Text="会话记录保存目录"/>
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBox x:Name="SessionDirectoryTextBox" Grid.Column="0" IsReadOnly="True" MaxWidth="280"/>
                            <Button x:Name="BrowseButton" Grid.Column="1" Content="..." Margin="5,0,0,0" Width="30"/>
                        </Grid>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </ScrollViewer>
        
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="10" Margin="0,20,0,0">
            <Button x:Name="SaveButton" Content="保存" Width="80"/>
            <Button x:Name="CancelButton" Content="取消" Width="80"/>
        </StackPanel>
    </Grid>
</Window>
